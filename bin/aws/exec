#!/bin/bash

# exit on failures
set -e
set -o pipefail

. "${APP_ROOT}/lib/colors.sh"

usage() {
  echo "Description: Execute an aws cli command within a target infrastructure"
  echo
  echo "Usage: dalmatian aws $(basename "$0") -i <infrastructure> <aws subcommand>" 1>&2
  echo "  -h                     Get help with this command"
  echo "  -i <infrastructure>    Name of the infrastructure you want to target"
  exit 1
}

# if there are no arguments passed exit with usage
if [ $# -eq 0 ]
then
  fatal "Please specify a target infrastructure"
  echo
  usage
  exit 0
fi

while getopts "i:h" opt; do
  case $opt in
    i)
      INFRASTRUCTURE_NAME=$OPTARG
      ;;
    h)
      usage
      exit;;
    *)
      usage
      exit;;
  esac
done

if [[ -z "$INFRASTRUCTURE_NAME" ]]
then
  fatal "Please specify a target infrastructure"
  echo
  usage
  exit 0
fi

shift $((OPTIND-1))

aws "$@"
